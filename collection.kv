<CardToggle>:
    background_normal: root.card.normalimage() if root.card else ''   
    background_down: root.card.downimage() if root.card else ''   

<PlayerSection@Button>:
    value: 0
    size_hint: (None, None)
    size: 200,100
    text: str(self.value) + ' Player'

<GamePlayScreen@Screen>:
    id: mainpage
    name: 'screen2'
    Label: 
        text: '[b]Collection[/b]'
        font_size: 30
        markup: True
        y: 450
    Label:
        size_hint: .1, .1
        text: str(root.aiScore)
        pos: root.width*3.5/5.5, root.height/6. - 20
        halign: 'center'
    Label:
        size_hint: .1, .1
        text: root.score_display
        pos: root.width*3.5/5.5, root.height/6.
        halign: 'center'        
    Label:
        size_hint: .1, .1
        text: "Number of sets " + str(root.numberofsets)
        pos: root.width*1.5/5.5, root.height/6.
        halign: 'center'
    Label:
        size_hint: .1, .1
        text: root.name_of_players[0] + ': '+ str(root.scores_of_players[0]) if root.number_of_players >= 1 else ''
        pos: root.width*1.5/5.5, root.height/6. - 20
        halign: 'center'    
    Label:
        size_hint: .1, .1
        text: root.name_of_players[1] + ': '+ str(root.scores_of_players[1]) if root.number_of_players >= 2 else ''
        pos: root.width*1.5/5.5, root.height/6. - 40
        halign: 'center'   
    Label:
        size_hint: .1, .1
        text: root.name_of_players[2] + ': '+ str(root.scores_of_players[2]) if root.number_of_players >= 3 else ''
        pos: root.width*1.5/5.5, root.height/6. - 60
        halign: 'center'   
    Label:
        size_hint: .1, .1
        text: root.name_of_players[3] + ': '+ str(root.scores_of_players[3]) if root.number_of_players >= 4 else ''
        pos: root.width*1.5/5.5, root.height/6. - 80
        halign: 'center'  

    Button:
        text: 'Settings'
        size: 100, 100
        x: 0
        y: 0
        size_hint: (None, None)
        on_press:
            root.stopClocks()
            app.open_settings()

    GridLayout:
        id: cards_layout
        cols: 3
        size_hint: 0.5,0.5
        spacing: '10dp'
        pos: root.width/4, root.height/4

<TutorialScreen@Widget>
    ScreenManager:
        id: tutorialScreens
        Screen:
            id: tutorial
            name: 'tutorial1'
            BoxLayout:
                orientation: 'vertical'
                padding: 10
                Label: 
                    size_hint: (1, .15)
                    text: 'How To Play Set'
                    font_size:40
                    font_name: 'DroidSans'
                    markup: True
                    size: 100,100
                    #pos: (root.width-100)/2, root.height-100
                Label: 
                    size_hint: (1, .7)
                    text: 'Welcome to Set!  \n  To get started, click on the number of players. \n You will be taken to the game screen, \n where 12 set cards have been dealt.  \n Try to find a SET.  Once you find one, \n click on the three cards and then click the SET button. \n If you have found a Set, \n you will be able to choose your name \n to receive points for your set.  \n Play continues until the deck runs out of cards. \n To learn what constitutes a set, \n go to the next tutorial screen.'
                    font_name: 'DroidSans'
                    markup: True
                    size: 100,100
                    #pos: (root.width-100)/2, root.height-200
                BoxLayout:
                    orientation: 'horizontal'
                    size_hint: (1,.1)
                    spacing: 5
                    AnchorLayout:
                        size_hint:(.3,1)
                    AnchorLayout:
                        size_hint:(.3,1)
                        Button:
                            anchor_x: 'center'
                            anchor_y: 'top'
                            text: 'Back to Main Screen'
                            size_hint: .9, 1
                            on_press: root.goToGameScreen() if root.active else root.goToIntro()
                    AnchorLayout:
                        size_hint:(.3,1)
                        Button:
                            anchor_x: 'right'
                            anchor_y: 'top'
                            text: 'Next: what is a SET?'
                            size_hint: .9, 1
                            on_press: tutorialScreens.current = 'tutorial2'
        Screen:
            id: tutorial2
            name: 'tutorial2'
            BoxLayout:
                orientation: 'vertical'
                padding: 10
                Label: 
                    size_hint: (1, .15)
                    text: 'Tutorial'
                    font_size:40
                    font_name: 'DroidSans'
                    markup: True
                    size: 100,100
                    #pos: (root.width-100)/2, root.height-100
                Label: 
                    size_hint: (1, .7)
                    text: 'Description here'
                    font_name: 'DroidSans'
                    markup: True
                    size: 100,100
                    #pos: (root.width-100)/2, root.height-200
                BoxLayout:
                    orientation: 'horizontal'
                    size_hint: (1,.1)
                    spacing: 5
                    AnchorLayout:
                        size_hint:(.3,1)
                        Button:
                            anchor_x: 'center'
                            anchor_y: 'top'
                            text: 'Back to instruction page'
                            size_hint: .9, 1
                            on_press: tutorialScreens.current = 'tutorial1'
                    AnchorLayout:
                        size_hint:(.3,1)
                        Button:
                            anchor_x: 'center'
                            anchor_y: 'top'
                            text: 'Back to Main Screen'
                            size_hint: .9, 1
                            on_press: root.goToGameScreen() if root.active else root.goToIntro()
                    AnchorLayout:
                        size_hint:(.3,1)
                        Button:
                            anchor_x: 'right'
                            anchor_y: 'top'
                            text: 'Next: Examples of Sets'
                            size_hint: .9, 1
                            on_press: tutorialScreens.current = 'tutorial3'
        Screen:
            id: tutorial3
            name: 'tutorial3'
            BoxLayout:
                orientation: 'vertical'
                padding: 10
                Label: 
                    size_hint: (1, .15)
                    text: 'Tutorial'
                    font_size:40
                    font_name: 'DroidSans'
                    markup: True
                    size: 100,100
                    #pos: (root.width-100)/2, root.height-100
                Label: 
                    size_hint: (1, .7)
                    text: 'Examples here'
                    font_name: 'DroidSans'
                    markup: True
                    size: 100,100
                    #pos: (root.width-100)/2, root.height-200
                BoxLayout:
                    orientation: 'horizontal'
                    size_hint: (1,.1)
                    spacing: 5
                    AnchorLayout:
                        size_hint:(.3,1)
                        Button:
                            anchor_x: 'center'
                            anchor_y: 'top'
                            text: 'Back to description page'
                            size_hint: .9, 1
                            on_press: tutorialScreens.current = 'tutorial2'
                    AnchorLayout:
                        size_hint:(.3,1)
                        Button:
                            anchor_x: 'center'
                            anchor_y: 'top'
                            text: 'Back to Main Screen'
                            size_hint: .9, 1
                            on_press: root.goToGameScreen() if root.active else root.goToIntro()
                    AnchorLayout:
                        size_hint:(.3,1)

<SelectPlayersPopup@Popup>:
    size_hint: 1, 1
    separator_height: 0
    title: 'Who found the collection?'
    
<PlayerNamePopup>:
    size_hint: .5, .5
    title: 'Enter Name of Player(s)'
    title_size: '20sp'
    separator_height: 5
    BoxLayout:
        orientation: 'vertical'
        size_hint_y: 0.8
        size_hint_x: 0.5
        spacing: '20dp'

#: import Deck Deck.Deck

<GameLayout>:
    ScreenManager:
        id: screenManager
        Screen:
            id: frontpage
            name: 'screen1'
            Label: 
                size_hint: (None, None)
                text: 'Collection'
                font_size:40
                font_name: 'DroidSans'
                markup: True
                size: 100,100
                pos: (root.width-100)/2, root.height-100
                
            GridLayout:
                cols: 2
                col_force_default: True
                col_default_height: 10
                col_default_width: root.width/3
                spacing: 30
                pos_hint: {'center_x':.5, 'center_y':.5}
                size_hint: (None, None)
                size: self.minimum_size
                top: self.height
                PlayerSection:
                    value: 1
                    on_press:
                        root.set_players(1)
                        screenManager.current = 'screen2'                

                PlayerSection:
                    value: 2
                    on_press:
                        root.set_players(2)
                        root.player_name_popup(2)

                PlayerSection:
                    value: 3
                    on_press:
                        root.set_players(3)
                        root.player_name_popup(3)

                PlayerSection:
                    value: 4
                    on_press:
                        root.set_players(4)
                        root.player_name_popup(4)  

            Button:
                text: 'Settings'
                size: 100, 100
                y: 0
                x: 0
                size_hint: (None, None)
                on_press: app.open_settings()

        GamePlayScreen:
            numberofsets: Deck.numberOfSets(root.cards)
            score_display: root.score_display
            goToIntro: root.goToIntro
            aiScore: "AI: " + str(root.aiScore) if root.aiActivated else ""
            stopClocks: root.stopClocks
            number_of_players: root.number_of_players
            name_of_players: root.name_of_players
            scores_of_players: root.scores_of_players

        Screen:
            id: gameoverpage
            name: 'screen3'
            Label:
                size_hint: (None, None)
                text: 'Game Over'
                font_size:40
                font_name: 'DroidSans'
                pos: (root.width-100)/2, root.height-100
            Label:
                size_hint: (None, None)
                text: 'scores will go here'
                font_name: 'DroidSans'
                pos: (root.width-100)/2, root.height-200 
            Button:
                text: 'Back to Main Screen'
                size_hint: (None,None)
                pos: (root.width-200)/2., root.height/5-100.
                size: 200,100
                on_press: screenManager.current = 'screen1'

        Screen:
            name: 'tutorialFlow'
            TutorialScreen:
                goToIntro: root.goToIntro
                active: root.active
                goToGameScreen: root.goToGameScreen
