<CardToggle>:
    background_normal: root.card.normalimage() if root.card else ''   
    background_down: root.card.downimage() if root.card else ''   
    canvas.before:
        PushMatrix
        Rotate:
            angle: self.angle
            origin: self.center
    canvas.after:
        PopMatrix

<PlayerSection@Button>:
    value: 0
    size_hint: (None, None)
    size: 200,100
    font_size: '30sp'
    size_hint_y: None
    height: self.texture_size[1] + dp(10)
    text: str(self.value) + ' Players' if self.value > 1 else '1 Player'

<GamePlayScreen@Screen>:
    id: mainpage
    name: 'screen2'

    canvas.before:
        Color:
            rgba: 173/255. , 255/255., 47/255., 0.8
        Rectangle:
            pos: self.pos
            size: self.size

    Label:
        id: label_ai
        size_hint: .1, .1
        color: 0, 0, 0, 1        
        text: str(root.aiScore)
        pos: (root.width-self.width)/2., root.height-self.height
        halign: 'center'
    Label:
        id: label_numCollections
        size_hint: .1, .1
        color: 0, 0, 0, 1        
        text: str(root.numberofsets) + " collections on the board" 
        halign: 'center'
        size: 100,100
        size_hint_y: None
        height: self.texture_size[1] + dp(10)           
        pos: label_ai.pos[0], label_ai.pos[1]-self.height/6.
    Label:
        id: label_p1
        size_hint: .1, .1
        color: 0, 0, 0, 1
        text: root.name_of_players[0] + ': '+ str(root.scores_of_players[0]) if root.number_of_players >= 1 else ''
        pos: [root.width-label_p2.x-label_p2.width, root.height-self.height] if root.number_of_players > 1 else [self.width/2., root.height-self.height]
        halign: 'center'
    Label:
        id: label_p2
        size_hint: .1, .1
        color: 0, 0, 0, 1        
        text: root.name_of_players[1] + ': '+ str(root.scores_of_players[1]) if root.number_of_players >= 2 else ''
        pos: root.width-self.width, label_p1.y
        halign: 'center'   
    Label:
        id: label_p3
        size_hint: .1, .1
        color: 0, 0, 0, 1        
        text: root.name_of_players[2] + ': '+ str(root.scores_of_players[2]) if root.number_of_players >= 3 else ''
        pos: label_p1.x, self.height/2.
        halign: 'center'   
    Label:
        id: label_p4    
        size_hint: .1, .1
        color: 0, 0, 0, 1
        text: root.name_of_players[3] + ': '+ str(root.scores_of_players[3]) if root.number_of_players >= 4 else ''
        pos: label_p2.x, label_p3.y
        halign: 'center'

    Button:
        id: settingsButton
        text: 'Settings'
        background_color: 102/255., 102/255., 0/255., 0.8
        size: 200, 80
        pos: (root.width-self.width)/2., 0
        size_hint: (None, None)
        on_press:
            root.stopClocks()
            app.open_settings()

    GridLayout:
        id: cards_layout
        cols: 3
        size_hint: 0.95, 0.7
        spacing: '10dp'
        pos: (root.width-self.width)/2., settingsButton.size[1]+10
        halign: 'center'


<TutorialScreen@Widget>
    ScreenManager:
        id: tutorialScreens
        Screen:
            id: tutorial
            name: 'tutorial1'
            BoxLayout:
                orientation: 'vertical'
                padding: 10
                Label: 
                    size_hint: (1, .15)
                    text: 'How To Play Set'
                    font_size:40
                    font_name: 'DroidSans'
                    markup: True
                    size: 100,100
                    #pos: (root.width-100)/2, root.height-100
                Label: 
                    size_hint: (1, .7)
                    text: 'Welcome to Set!  \n  To get started, click on the number of players. \n You will be taken to the game screen, \n where 12 set cards have been dealt.  \n Try to find a SET.  Once you find one, \n click on the three cards and then click the SET button. \n If you have found a Set, \n you will be able to choose your name \n to receive points for your set.  \n Play continues until the deck runs out of cards. \n To learn what constitutes a set, \n go to the next tutorial screen.'
                    font_name: 'DroidSans'
                    markup: True
                    size: 100,100
                    #pos: (root.width-100)/2, root.height-200
                BoxLayout:
                    orientation: 'horizontal'
                    size_hint: (1,.1)
                    spacing: 5
                    AnchorLayout:
                        size_hint:(.3,1)
                    AnchorLayout:
                        size_hint:(.3,1)
                        Button:
                            anchor_x: 'center'
                            anchor_y: 'top'
                            text: 'Back to Main Screen'
                            size_hint: .9, 1
                            on_press: root.goToGameScreen() if root.active else root.goToIntro()
                    AnchorLayout:
                        size_hint:(.3,1)
                        Button:
                            anchor_x: 'right'
                            anchor_y: 'top'
                            text: 'Next: what is a SET?'
                            size_hint: .9, 1
                            on_press: tutorialScreens.current = 'tutorial2'
        Screen:
            id: tutorial2
            name: 'tutorial2'
            BoxLayout:
                orientation: 'vertical'
                padding: 10
                Label: 
                    size_hint: (1, .15)
                    text: 'Tutorial'
                    font_size:40
                    font_name: 'DroidSans'
                    markup: True
                    size: 100,100
                    #pos: (root.width-100)/2, root.height-100
                Label: 
                    size_hint: (1, .7)
                    text: 'Description here'
                    font_name: 'DroidSans'
                    markup: True
                    size: 100,100
                    #pos: (root.width-100)/2, root.height-200
                BoxLayout:
                    orientation: 'horizontal'
                    size_hint: (1,.1)
                    spacing: 5
                    AnchorLayout:
                        size_hint:(.3,1)
                        Button:
                            anchor_x: 'center'
                            anchor_y: 'top'
                            text: 'Back to instruction page'
                            size_hint: .9, 1
                            on_press: tutorialScreens.current = 'tutorial1'
                    AnchorLayout:
                        size_hint:(.3,1)
                        Button:
                            anchor_x: 'center'
                            anchor_y: 'top'
                            text: 'Back to Main Screen'
                            size_hint: .9, 1
                            on_press: root.goToGameScreen() if root.active else root.goToIntro()
                    AnchorLayout:
                        size_hint:(.3,1)
                        Button:
                            anchor_x: 'right'
                            anchor_y: 'top'
                            text: 'Next: Examples of Sets'
                            size_hint: .9, 1
                            on_press: tutorialScreens.current = 'tutorial3'
        Screen:
            id: tutorial3
            name: 'tutorial3'
            BoxLayout:
                orientation: 'vertical'
                padding: 10
                Label: 
                    size_hint: (1, .15)
                    text: 'Tutorial'
                    font_size:40
                    font_name: 'DroidSans'
                    markup: True
                    size: 100,100
                    #pos: (root.width-100)/2, root.height-100
                Label: 
                    size_hint: (1, .7)
                    text: 'Examples here'
                    font_name: 'DroidSans'
                    markup: True
                    size: 100,100
                    #pos: (root.width-100)/2, root.height-200
                BoxLayout:
                    orientation: 'horizontal'
                    size_hint: (1,.1)
                    spacing: 5
                    AnchorLayout:
                        size_hint:(.3,1)
                        Button:
                            anchor_x: 'center'
                            anchor_y: 'top'
                            text: 'Back to description page'
                            size_hint: .9, 1
                            on_press: tutorialScreens.current = 'tutorial2'
                    AnchorLayout:
                        size_hint:(.3,1)
                        Button:
                            anchor_x: 'center'
                            anchor_y: 'top'
                            text: 'Back to Main Screen'
                            size_hint: .9, 1
                            on_press: root.goToGameScreen() if root.active else root.goToIntro()
                    AnchorLayout:
                        size_hint:(.3,1)

<SelectPlayersPopup@Popup>:
    size_hint: 1, 1
    separator_height: 0
    title: 'Who found the collection?'
    
<PlayerNamePopup>:
    size_hint: .5, .5
    title: 'Enter Name of Player(s)'
    title_size: '20sp'
    separator_height: 5
    BoxLayout:
        orientation: 'vertical'
        size_hint_y: 0.8
        size_hint_x: 0.5
        spacing: '20dp'

#: import Deck Deck.Deck

<CollectionTitle@Label>:
    size_hint: (None, None)
    text: 'Collection'
    markup: True
    size: 100,100
    font_size: '40sp'
    size_hint_y: None
    height: self.texture_size[1] + dp(10) 

<GameLayout>:
    ScreenManager:
        id: screenManager
        Screen:
            id: frontpage
            name: 'screen1'
            RelativeLayout:
                CollectionTitle:
                    pos: (root.width-100)/2, root.height-100              
                GridLayout:
                    cols: 2
                    col_force_default: True
                    row_default_height: root.width/6
                    col_default_width: root.width/3
                    spacing: 30
                    pos_hint: {'center_x':.5, 'center_y':.5}
                    size_hint: (None, None)
                    size: self.minimum_size
                    top: self.height
                    PlayerSection:
                        value: 1
                        on_press:
                            root.set_players(1)
                            screenManager.current = 'screen2'                

                    PlayerSection:
                        value: 2
                        on_press:
                            root.set_players(2)
                            root.player_name_popup(2)

                    PlayerSection:
                        value: 3
                        on_press:
                            root.set_players(3)
                            root.player_name_popup(3)

                    PlayerSection:
                        value: 4
                        on_press:
                            root.set_players(4)
                            root.player_name_popup(4)  

                Button:
                    text: 'Settings'
                    size: '100sp', '100sp'
                    y: 0
                    x: 0
                    size_hint: (None, None)
                    on_press: app.open_settings()

        GamePlayScreen:
            numberofsets: Deck.numberOfSets(root.cards)
            score_display: root.score_display
            goToIntro: root.goToIntro
            aiScore: "AI: " + str(root.aiScore) if root.aiActivated else ""
            stopClocks: root.stopClocks
            number_of_players: root.number_of_players
            name_of_players: root.name_of_players
            scores_of_players: root.scores_of_players
            screenManager: root.children[0]

        EndGameScreen:
            id: gameoverpage
            name: 'screen3'
            name_of_players: root.name_of_players
            scores_of_players: root.scores_of_players
            screenManager: root.children[0]
            number_of_players: root.number_of_players

        Screen:
            name: 'tutorialFlow'
            TutorialScreen:
                goToIntro: root.goToIntro
                active: root.active
                goToGameScreen: root.goToGameScreen


<Scores@Label>:
    size_hint: (None, None)
    markup: True
    size: 100,100
    x: 350
    font_size: '30sp'
    size_hint_y: None
    height: self.texture_size[1] + dp(10) 
    spacing: '5dp'


<EndGameScreen>:
    Label:
        size_hint: (None, None)
        text: 'Game Over'
        font_size:40
        font_name: 'DroidSans'
        pos: (root.width-100)/2, root.height-100
    Button:
        text: 'Back to Main Screen'
        size_hint: (None,None)
        pos: (root.width-200)/2., root.height/5-100.
        size: 200,100
        on_press: root.screenManager.current = 'screen1'
    Scores:
        text: root.name_of_players[0]+ ':      ' + str(root.scores_of_players[0]) if root.number_of_players>=1 else ''
        y: root.height-300
    Scores:
        text: root.name_of_players[1]+ ':      ' + str(root.scores_of_players[1]) if root.number_of_players >= 2 else ''
        y: root.height-350
    Scores:
        text: root.name_of_players[2]+ ':      ' + str(root.scores_of_players[2]) if root.number_of_players>=3 else ''
        y: root.height-400
    Scores:
        text: root.name_of_players[3]+ ':      ' + str(root.scores_of_players[3]) if root.number_of_players==4 else ''
        y: root.height-450


